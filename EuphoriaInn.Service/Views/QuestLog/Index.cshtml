@using EuphoriaInn.Service.ViewModels.QuestLogViewModels
@model QuestLogIndexViewModel
@{
    ViewData["Title"] = "Quest Log";
}

<div class="quest-log-container">
    <div class="quest-log-header">
        <h1><i class="fas fa-book-open me-3"></i>Quest Log</h1>
        <p class="mb-0">"A chronicle of legendary adventures and heroic deeds..."</p>
    </div>

    @if (Model.CompletedQuests?.Any() == true)
    {
        <div class="quest-log-grid">
            @foreach (var quest in Model.CompletedQuests)
            {
                // Calculate some stats for the quest
                var selectedPlayers = quest.PlayerSignups.Where(ps => ps.IsSelected).ToList();
                var questDate = quest.FinalizedDate?.ToString("MMMM dd, yyyy") ?? "Unknown Date";

                <div class="quest-log-card" onclick="window.location.href='@Url.Action("Details", "QuestLog", new { id = quest.Id })'">
                    
                    <!-- Quest Header -->
                    <div class="quest-log-card-header">
                        <h3 class="quest-log-card-title">@quest.Title</h3>
                        <span class="cr-badge">
                            <i class="fas fa-dice-d20 me-1"></i>
                            CR @quest.ChallengeRating
                        </span>
                    </div>

                    <!-- Quest Body -->
                    <div class="quest-log-card-body">
                        <!-- Quest Info -->
                        <div class="quest-log-meta">
                            <div class="meta-item">
                                <i class="fas fa-crown me-2"></i>
                                <span><strong>DM:</strong> @quest.DungeonMaster?.Name</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-calendar-check me-2"></i>
                                <span><strong>Completed:</strong> @questDate</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-users me-2"></i>
                                <span><strong>Adventurers:</strong> @selectedPlayers.Count</span>
                            </div>
                        </div>

                        <!-- Quest Description Preview -->
                        <div class="quest-log-card-description">
                            @{
                                var shortDescription = quest.Description.Length > 200 
                                    ? quest.Description.Substring(0, 200) + "..." 
                                    : quest.Description;
                            }
                            @shortDescription
                        </div>
                    </div>

                    <!-- Quest Footer -->
                    <div class="quest-log-card-footer">
                        @if (!string.IsNullOrWhiteSpace(quest.Recap))
                        {
                            <span class="recap-badge">
                                <i class="fas fa-scroll me-1"></i>Session Recap Available
                            </span>
                        }
                        <span class="view-details-text">
                            Click to view details <i class="fas fa-arrow-right ms-1"></i>
                        </span>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-quest-log">
            <i class="fas fa-book-open fa-3x mb-3"></i>
            <h3>No Completed Quests Yet</h3>
            <p>Completed quests will appear here once they have been undertaken and finished.</p>
        </div>
    }
</div>
